<html>
  <head>
    <script src="https://d3js.org/d3.v7.min.js"></script>
  </head>
  <body>
    <script>
      // where the formatted data will be stored
      let visualization_data = {};

      //  load movie data with aync request
      d3.csv('movies.csv').then(function (data) {
        data.forEach(function (data) {
          movie_name = data['Movie Name'];
          movie_data = [];
          // if in data dict, just update the relationship_ages
          if (movie_name in visualization_data) {
            movie_data = visualization_data[movie_name];
          }
          // if not already in data dict, create the initial dictionary struct
          else {
            movie_data = {
              relationship_ages: [],
              movie_year: data['Release Year'],
            };
          }
          // add the relationship
          movie_data['relationship_ages'].push([
            data['Actor 1 Age'],
            data['Actor 2 Age'],
          ]);
          visualization_data[movie_name] = movie_data;
        });
      });

      // the "ratings.csv" data was generated via OMDB API requests
      // (see "fill_ratings_csv.py" for reference)
      //  load rating data for each movie with aync request
      d3.csv('ratings.csv').then(function (data) {
        data.forEach(function (data) {
          movie_name = data['Movie Title'];
          movie_rating = data['Imdb Rating'];
          movie_data = visualization_data[movie_name];

          // remove movie data without any ratings data
          if (movie_rating == 'None') {
            delete visualization_data[movie_name];
          } else {
            movie_data['movie_rating'] = movie_rating;
            visualization_data[movie_name] = movie_data;
          }
        });
        // see data format in console
        console.log(visualization_data);
      });
    </script>
  </body>
</html>
